<script>
        // --- CONFIG & API ---
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyX7ZJvwflkNzhZ1SPPOJZZcJBvh_Bpbc2acOjh6fEcj58fv9wHu4i9M8J5BoCNmIoDbw/exec';
        
        let currentSessionId = "";
        let analysisMeta = {}; 
        let selectedTraits = new Set(); 
        let selectedHealth = new Set(); 

        // --- 1. CORE LOGIC (ย่อ) ---
        class ThaiLunarCalendar{constructor(){this.startYData=[[1901,0.122733000004352],[1906,0.0191890000045229],[1911,-0.0843549999953059],[1916,-0.187898999995135],[1921,-0.291442999994964],[1926,0.0744250000052413],[1931,-0.0291189999945876],[1936,-0.132662999994416],[1941,-0.236206999994245],[1946,-0.339750999994074],[1951,-0.443294999993903],[1956,-0.0774269999936981],[1961,-0.180970999993527],[1966,-0.284514999993356],[1971,-0.388058999993185],[1976,-0.491602999993014],[1981,-0.595146999992842],[1986,-0.698690999992671],[1991,-0.332822999992466],[1996,-0.436366999992295],[2001,-0.539910999992124],[2006,-0.643454999991953],[2011,0.253001000008218],[2016,0.149457000008389],[2021,-0.484674999991406],[2026,-0.588218999991235],[2031,0.308237000008937],[2036,0.204693000009108],[2041,0.101149000009279],[2046,-0.00239499999055015],[2051,-0.105938999990379],[2056,0.259929000009826],[2061,0.156385000009997],[2066,0.0528410000101682]];this.sDate=[new Date(1902,10,30),new Date(1912,11,8),new Date(1922,10,19),new Date(1932,10,27),new Date(1942,11,7),new Date(1952,10,16),new Date(1962,10,26),new Date(1972,11,5),new Date(1982,10,15),new Date(1992,10,24),new Date(2002,11,4),new Date(2012,10,13),new Date(2022,10,23),new Date(2032,11,2),new Date(2042,11,12),new Date(2052,10,21),new Date(2062,11,1),new Date(2072,11,9)];}xlMod(a,b){return a-b*Math.floor(a/b)}athikaMas(i){let a=this.xlMod((i-78)-0.45222,2.7118886);return a<1}athikaVar(i){if(this.athikaMas(i))return!1;let c;if(this.athikaMas(i+1))c=0.0169501433191599;else c=-0.0142223099315486;return this.deviation(i)>c}deviation(y){let f=0,fy=0,c=0,l=0;for(let k=0;k<this.startYData.length;k++){if(y>=this.startYData[k][0]){fy=this.startYData[k][0];f=this.startYData[k][1]}else break}if(fy===0)return 0;if(y===fy)c=f;else{fy++;for(let i=fy;i<=y;i++){if(i===fy)l=f;else l=c;if(this.athikaMas(i-1))c=-0.102356;else if(this.athikaVar(i-1))c=-0.632944;else c=0.367056;c=l+c}}return c}lDayInYear(i){if(this.athikaMas(i))return 384;else if(this.athikaVar(i))return 355;else return 354}getThaiLunarDate(d){const y=d.getFullYear();if(y<1903||y>2082)return null;let b;const cy=y-1;const sy=1902;let bk=Math.floor((cy-sy)/10);if(bk<0)bk=0;if(bk>17)bk=17;b=new Date(this.sDate[bk]);let t=new Date(b);for(let i=b.getFullYear()+1;i<=y-1;i++){t.setDate(t.getDate()+this.lDayInYear(i))}b=new Date(t);let ep=new Date(b.getFullYear(),11,31);let rp=Math.round((ep-b)/(86400000));let sc=new Date(y,0,1);let dy=Math.round((d-sc)/(86400000));let df=rp+dy+1;let ny=this.lDayInYear(y);let dof=df,tm,ts;let md=[];if(ny===354)md=[29,30,29,30,29,30,29,30,29,30,29,30,29,30];else if(ny===355)md=[29,30,29,30,29,30,30,30,29,30,29,30,29,30];else if(ny===384)md=[29,30,29,30,29,30,29,30,30,29,30,29,30,29,30];for(let j=0;j<md.length;j++){tm=j+1;if(dof<=md[j]&&dof>0)break;else dof-=md[j]}if(ny===384){if(tm>13)tm-=13;if(tm===9)tm=88;else if(tm>=10)tm=tm-1}else{if(tm>12)tm-=12}if(dof>15){ts="Waning";dof-=15}else{ts="Waxing"}const tn=["๐","๑","๒","๓","๔","๕","๖","๗","๘","๙"];const tt=(n)=>n.toString().split('').map(x=>tn[x]||x).join('');let mdsp=tm;if(tm==88)mdsp="๘๘";else mdsp=tt(tm);return{phase:ts,day:dof,month:tm,year:y,display:`${ts=='Waxing'?'ขึ้น':'แรม'} ${tt(dof)} ค่ำ เดือน ${mdsp}`}}}

        // --- 2. DATASET ---
        const baseElementData = {
            earth: {
                name: "ธาตุดิน (ปถวี)",
                traits: ["รูปร่างสูงใหญ่", "แข็งแรง", "กระดูกใหญ่", "ผมดกดำหนา", "พูดจาฉะฉาน", "เสียงดัง", "หนักแน่น", "สุขุมรอบคอบ", "จิตใจมั่นคง", "ดื้อรั้น"],
                recTaste: "ฝาด, หวาน, มัน, เค็ม",
                recReason: "บำรุงธาตุดินให้สมบูรณ์ สมานแผลภายใน (ฝาด) ให้กำลัง (หวาน/มัน/เค็ม)",
                badTaste: "มันจัดเกินไป, หวานจัดเกินไป",
                badReason: "ดูดซึมและเผาผลาญยาก ทำให้ธาตุดินกำเริบ (อ้วน/ไขมัน)",
                foods: ["ผักกูด", "แกงเลียง", "แกงจืดเต้าหู้", "มัสมั่น (พอดี)", "พะโล้", "ราดหน้า", "ยำถั่วพู"],
                fruits: ["มังคุด", "ฝรั่งดิบ", "ฟักทอง", "เผือก", "ถั่วต่างๆ", "เงาะ", "น้ำนม", "อ้อย"]
            },
            fire: {
                name: "ธาตุไฟ (เตโช)",
                traits: ["รูปร่างสมส่วน", "ผิวขาวเหลือง", "พูดชัด", "เสียงดัง", "หิวบ่อย", "กินจุ", "ขี้หงุดหงิด", "โกรธง่ายหายเร็ว", "ผมหงอกก่อนวัย"],
                recTaste: "ขม, เย็น, จืด",
                recReason: "ช่วยลดความร้อน ดับพิษร้อนในร่างกาย",
                badTaste: "รสจัด (เผ็ด/เปรี้ยว/เค็ม), ร้อน",
                badReason: "กระตุ้นธาตุไฟให้กำเริบ ทำให้ร้อนใน เป็นไข้ หงุดหงิด",
                foods: ["แกงจืดตำลึง", "ต้มฟัก", "ผัดผักบุ้ง", "แตงกวาผัดไข่", "แกงส้ม (ไม่เผ็ดมาก)", "น้ำพริกหนุ่ม"],
                fruits: ["แตงโม", "แคนตาลูป", "แก้วมังกร", "ชมพู่", "มังคุด", "ส้มโอ"]
            },
            wind: {
                name: "ธาตุลม (วาโย)",
                traits: ["ร่างกายผอม", "ผิวแห้ง", "ผมบาง", "พูดเยอะ", "อารมณ์แปรปรวน", "ขี้กลัว", "วิตกกังวล", "อยากรู้อยากเห็น", "นอนหลับยาก"],
                recTaste: "เผ็ดร้อน, สุขุม",
                recReason: "ช่วยขับลม กระจายเลือดลม แก้ท้องอืดท้องเฟ้อ",
                badTaste: "รสจัดเกินไป, ของหมักดอง",
                badReason: "ทำให้เสมหะเหนียวข้น เลือดลมเดินไม่สะดวก",
                foods: ["ต้มยำ", "ข่าไก่", "แกงป่า", "ผัดกะเพรา", "ไก่ผัดขิง", "น้ำพริกขิง"],
                fruits: ["ส้ม", "เงาะ", "สละ", "ลองกอง", "ลำไย", "น้ำขิง"]
            },
            water: {
                name: "ธาตุน้ำ (อาโป)",
                traits: ["รูปร่างอวบ", "ผิวขาว", "ตาโต", "พูดช้าเสียงไพเราะ", "เคลื่อนไหวช้า", "ผมละเอียดสวย", "ผมดกดำ", "ชอบนอน", "ใจเย็น"],
                recTaste: "เปรี้ยว, ขม, ร้อน",
                recReason: "ช่วยกัดเสมหะ (เสมหะ) บำรุงโลหิต และขับน้ำส่วนเกิน",
                badTaste: "หวานจัด, เปรี้ยวจัด, เค็มจัด",
                badReason: "ทำให้น้ำเหลืองเสีย เพิ่มเสมหะ และตัวบวมง่าย",
                foods: ["แกงส้มดอกแค", "ต้มยำปลา", "ห่อหมก", "แกงเหลือง", "น้ำพริกมะขาม", "ส้มตำ"],
                fruits: ["สับปะรด", "ส้มโอ", "มะเฟือง", "มะขามป้อม", "ตะลิงปลิง"]
            },
            fire_wind: {
                name: "ธาตุไฟระคนลม (ช่วงรอยต่อ)",
                traits: ["ผสมผสาน", "หงุดหงิดง่าย (ไฟ)", "ขี้กังวล (ลม)", "พูดเร็ว", "คิดเร็ว"],
                recTaste: "จืด, หอมเย็น, สุขุม",
                recReason: "ดับพิษร้อนและแก้วิงเวียนศีรษะ",
                badTaste: "เผ็ดจัด, ร้อนจัด",
                badReason: "กระตุ้นทั้งลมและไฟให้กำเริบพร้อมกัน",
                foods: ["แกงจืด", "ปลานึ่ง", "ผัดขิง (อ่อนๆ)", "น้ำสมุนไพรฤทธิ์เย็น"],
                fruits: ["แตงโม", "ส้มโอ", "แก้วมังกร"]
            }
        };

        const sadaoData = [
            { check: (m, p) => (m==1 && p=='Waning') || (m==2 && p=='Waxing'), range: "แรม ๑ ค่ำ เดือน ๑ - ขึ้น ๑๕ ค่ำ เดือน ๒", baseElement: "earth", 
              health: ["ท้องผูก", "ขับถ่ายลำบาก", "ปวดท้อง", "ลมติดในเส้น"] },
            { check: (m, p) => (m==2 && p=='Waning') || (m==3 && p=='Waxing'), range: "แรม ๑ ค่ำ เดือน ๒ - ขึ้น ๑๕ ค่ำ เดือน ๓", baseElement: "earth", 
              health: ["หายใจไม่สุด", "หายใจไม่เต็มอิ่ม", "เหนื่อยง่าย"] },
            { check: (m, p) => (m==3 && p=='Waning') || (m==4 && p=='Waxing'), range: "แรม ๑ ค่ำ เดือน ๓ - ขึ้น ๑๕ ค่ำ เดือน ๔", baseElement: "earth", 
              health: ["ถ่ายเหลวได้ง่าย", "ลำไส้แปรปรวน", "ปัญหาประจำเดือน", "ปัญหาระบบปัสสาวะ"] },
            
            { check: (m, p) => (m==4 && p=='Waning') || (m==5 && p=='Waxing'), range: "แรม ๑ ค่ำ เดือน ๔ - ขึ้น ๑๕ ค่ำ เดือน ๕", baseElement: "fire", 
              health: ["เป็นลม", "หน้ามืด", "ไข้แดด", "ร้อนใน", "หลับยาก"] },
            { check: (m, p) => (m==5 && p=='Waning') || (m==6 && p=='Waxing'), range: "แรม ๑ ค่ำ เดือน ๕ - ขึ้น ๑๕ ค่ำ เดือน ๖", baseElement: "fire", 
              health: ["ร้อนใน", "กระหายน้ำ", "ความร้อนภายใน"] },
            { check: (m, p) => (m==6 && p=='Waning') || (m==7 && p=='Waxing'), range: "แรม ๑ ค่ำ เดือน ๖ - ขึ้น ๑๕ ค่ำ เดือน ๗", baseElement: "fire", 
              health: ["ความดันโลหิต", "อารมณ์แปรปรวน", "นอนหลับยาก", "ตื่นง่าย"] },
            
            { check: (m, p) => (m==8 && p=='Waning') || (m==9 && p=='Waxing'), range: "แรม ๑ ค่ำ เดือน ๘ - ขึ้น ๑๕ ค่ำ เดือน ๙", baseElement: "fire_wind", 
              health: ["ปวดศีรษะ", "ปวดกระบอกตา", "หูอื้อ", "วิงเวียน", "ท้องอืด", "แน่นท้อง"] },
            
            { check: (m, p) => (m==7 && p=='Waning') || (m==8 && p=='Waxing'), range: "แรม ๑ ค่ำ เดือน ๗ - ขึ้น ๑๕ ค่ำ เดือน ๘", baseElement: "wind", 
              health: ["ไอ", "ระคายเคืองคอ", "เจ็บคอ", "จุกคอ", "ลมตีขึ้น"] },
            { check: (m, p) => (m==9 && p=='Waning') || (m==10 && p=='Waxing'), range: "แรม ๑ ค่ำ เดือน ๙ - ขึ้น ๑๕ ค่ำ เดือน ๑๐", baseElement: "wind", 
              health: ["กรดไหลย้อน", "ท้องเฟ้อ", "ท้องบิด", "แสบร้อนกลางอก", "อาหารไม่ย่อย"] },
            
            { check: (m, p) => (m==10 && p=='Waning') || (m==11 && p=='Waxing'), range: "แรม ๑ ค่ำ เดือน ๑๐ - ขึ้น ๑๕ ค่ำ เดือน ๑๑", baseElement: "water", 
              health: ["ปวดในข้อ", "ปวดเข่า", "ปวดกระดูก", "ริดสีดวง", "ฝี", "สิว"] },
            { check: (m, p) => (m==11 && p=='Waning') || (m==12 && p=='Waxing'), range: "แรม ๑ ค่ำ เดือน ๑๑ - ขึ้น ๑๕ ค่ำ เดือน ๑๒", baseElement: "water", 
              health: ["ภูมิแพ้", "หวัด", "น้ำมูก", "กรน", "หายใจติดขัด", "แน่นหน้าอก"] },
            { check: (m, p) => (m==12 && p=='Waning') || (m==1 && p=='Waxing'), range: "แรม ๑ ค่ำ เดือน ๑๒ - ขึ้น ๑๕ ค่ำ เดือน ๑", baseElement: "water", 
              health: ["ผดผื่น", "สิว", "ลมพิษ", "คันง่าย", "ภูมิแพ้ผิวหนัง"] }
        ];

        const seasonData = {
            summer: { name: "คิมหันตฤดู (ร้อน)", vul: "ธาตุไฟ", health: "เสี่ยงลมแดด ร้อนใน กระหายน้ำ", food: "อาหารรสขม เย็น จืด", theme: "summer", fx: "sun" },
            rain: { name: "วสันตฤดู (ฝน)", vul: "ธาตุลม/ไฟ", health: "ระวังไข้หวัด วิงเวียน ศีรษะ", food: "อาหารรสเปรี้ยว เผ็ดร้อน", theme: "rain", fx: "rain" },
            winter: { name: "เหมันตฤดู (หนาว)", vul: "ธาตุน้ำ/ดิน", health: "ผิวแห้ง ปวดข้อ น้ำมูกไหล", food: "อาหารรสมัน เค็ม ร้อน", theme: "winter", fx: "snow" }
        };

        // --- 3. APP LOGIC ---
        const calendar = new ThaiLunarCalendar();

        window.onload = function() {
            currentSessionId = 'u' + Date.now() + 'r' + Math.floor(Math.random()*1000);
            
            const dS = document.getElementById('inputDay'); for(let i=1; i<=31; i++) { let o = document.createElement('option'); o.value=i; o.innerText=i; dS.appendChild(o); }
            const mS = document.getElementById('inputMonth'); const months = ["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"]; months.forEach((m,i)=>{ let o=document.createElement('option'); o.value=i+1; o.innerText=m; mS.appendChild(o); });
            const yS = document.getElementById('inputYear'); const curY = new Date().getFullYear(); for(let i=0; i<100; i++) { let y = curY-i; let o = document.createElement('option'); o.value = y; o.innerText = y+543; yS.appendChild(o); } yS.value = curY-30;
            
            updateDailyForecast();
        }

        function calculateRealLunarDate(date) { return calendar.getThaiLunarDate(date); }
        function getDailySeason(m) { if (m>=5 && m<=6) return seasonData.summer; if (m>=7 && m<=10) return seasonData.rain; return seasonData.winter; }

        function updateDailyForecast() {
            const today = new Date(); const lunar = calculateRealLunarDate(today); if(!lunar) return;
            let checkM = lunar.month; if(checkM==88) checkM=8;
            const season = getDailySeason(checkM);
            const mTh = ["ม.ค.","ก.พ.","มี.ค.","เม.ย.","พ.ค.","มิ.ย.","ก.ค.","ส.ค.","ก.ย.","ต.ค.","พ.ย.","ธ.ค."];
            document.getElementById('todayDate').innerText = `${today.getDate()} ${mTh[today.getMonth()]} ${today.getFullYear()+543}`;
            document.getElementById('todaySeason').innerText = season.name;
            document.getElementById('todayVulnerable').innerText = season.vul;
            document.getElementById('todayHealth').innerText = season.health;
            document.getElementById('todayFood').innerText = `แนะนำ: ${season.food}`;
            
            const div = document.getElementById('weatherContainer'); div.innerHTML='';
            const front = document.getElementById('cardFront');
            front.classList.remove('theme-winter','theme-summer','theme-rain'); front.classList.add(`theme-${season.theme}`);
            if(season.fx=='rain') { for(let i=0;i<30;i++){ let d=document.createElement('div'); d.className='rain'; d.style.left=Math.random()*100+'%'; d.style.animationDuration=(0.5+Math.random())+'s'; div.appendChild(d); }}
            else if(season.fx=='sun') { let s=document.createElement('div'); s.className='sun-glare'; div.appendChild(s); }
            else { for(let i=0;i<30;i++){ let s=document.createElement('div'); s.className='snowflake'; s.style.left=Math.random()*100+'%'; s.style.animationDuration=(3+Math.random()*2)+'s'; div.appendChild(s); }}
        }

        function createChips(items, containerId, selectionSet) {
            const c = document.getElementById(containerId); c.innerHTML = '';
            items.forEach(item => {
                const chip = document.createElement('div');
                chip.className = 'chip';
                chip.innerText = item;
                chip.onclick = function() {
                    this.classList.toggle('selected');
                    if(this.classList.contains('selected')) selectionSet.add(item);
                    else selectionSet.delete(item);
                };
                c.appendChild(chip);
            });
        }

        function createFoodTags(items, id) {
            const c = document.getElementById(id); c.innerHTML='';
            items.forEach(i => {
                let a = document.createElement('a'); a.className='food-link-tag';
                a.innerHTML = `${i} <i class="fas fa-search text-xs ml-1 text-gray-400"></i>`;
                a.href = `https://www.google.com/search?tbm=isch&q=${i} อาหาร`; a.target = '_blank'; c.appendChild(a);
            });
        }

        // --- OPTIMIZED LOGGING (Fire & Forget) ---
        function logToGoogleSheet(data) {
            fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST', mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            }).catch(e => console.error("Log Error:", e));
        }

        async function startAnalysis() {
            document.getElementById('loading').style.display = 'flex';
            
            // Reduced Timeout for faster feel (100ms)
            setTimeout(() => {
                try {
                    const d = parseInt(document.getElementById('inputDay').value);
                    const m = parseInt(document.getElementById('inputMonth').value);
                    const y = parseInt(document.getElementById('inputYear').value);
                    
                    let birthDate = new Date(y, m-1, d);
                    let conceptionDate = new Date(birthDate); conceptionDate.setMonth(birthDate.getMonth()-9);
                    const lunar = calculateRealLunarDate(conceptionDate);
                    
                    if (!lunar) { alert("ปีไม่อยู่ในช่วงที่รองรับ"); document.getElementById('loading').style.display = 'none'; return; }

                    let checkMonth = lunar.month; if (checkMonth == 88) checkMonth = 8;
                    let key = "earth"; let specificHealthArr = []; let range = ""; let matched = false;

                    for (let rule of sadaoData) {
                        if (rule.check(checkMonth, lunar.phase)) {
                            key = rule.baseElement; 
                            specificHealthArr = rule.health; 
                            range = rule.range; 
                            matched = true; 
                            break;
                        }
                    }
                    
                    if(!matched) {
                        if(checkMonth >= 1 && checkMonth <= 4) { key="earth"; specificHealthArr=["ท้องผูก"]; }
                        else if(checkMonth >= 5 && checkMonth <= 7) { key="fire"; specificHealthArr=["ร้อนใน"]; }
                        else if(checkMonth >= 8 && checkMonth <= 10) { key="wind"; specificHealthArr=["ท้องอืด"]; }
                        else { key="water"; specificHealthArr=["ภูมิแพ้"]; }
                    }

                    const data = baseElementData[key];
                    
                    // Clear old selections
                    selectedTraits.clear();
                    selectedHealth.clear();
                    
                    // Save meta
                    analysisMeta = {
                        sessionId: currentSessionId,
                        birthDate: `${d}/${m}/${y+543}`,
                        element: data.name,
                        conceptionDate: lunar.display
                    };

                    // UI Updates
                    document.getElementById('resMain').innerText = data.name;
                    document.getElementById('resSub').innerText = range; 
                    document.getElementById('debugCalc').innerText = `(ปฏิสนธิ: ${lunar.display})`;
                    document.getElementById('avatarImg').src = key.includes("fire") ? "https://img5.pic.in.th/file/secure-sv1/41a8f63dde1ba7c4b.png" : (key.includes("wind") ? "https://img2.pic.in.th/261c90e765ec6b116.png" : (key.includes("water") ? "https://img5.pic.in.th/file/secure-sv1/3141eb0166e3e7f51.png" : "https://img2.pic.in.th/1c8b450894dd6fe8e.png"));
                    document.getElementById('avatarImg').classList.remove('hidden');
                    
                    let color = "";
                    if(key.includes("fire")) color = "linear-gradient(135deg, #FF9966, #FF5E62)";
                    else if(key.includes("wind")) color = "linear-gradient(135deg, #56ab2f, #a8e063)";
                    else if(key.includes("water")) color = "linear-gradient(135deg, #36D1DC, #5B86E5)";
                    else color = "linear-gradient(135deg, #CAC531, #F3F9A7)";
                    document.getElementById('resultHeader').style.background = color;

                    createChips(data.traits, 'traitChips', selectedTraits);
                    createChips(specificHealthArr, 'healthChips', selectedHealth);

                    document.getElementById('resTasteGood').innerText = data.recTaste;
                    document.getElementById('resTasteGoodReason').innerText = data.recReason;
                    document.getElementById('resTasteBad').innerHTML = `<span class="font-bold text-red-800">${data.badTaste}</span><br>${data.badReason}`;
                    
                    createFoodTags(data.foods, 'foodList');
                    createFoodTags(data.fruits, 'fruitList');

                    // 1. Flip & Hide Spinner FIRST (Fast UX)
                    document.getElementById('cardObject').classList.add('is-flipped');
                    document.getElementById('loading').style.display = 'none';

                    // 2. Log Data in Background (Don't wait)
                    logToGoogleSheet({
                        type: 'analysis',
                        sessionId: currentSessionId,
                        timestamp: new Date().toISOString(),
                        ...analysisMeta
                    });

                } catch (e) {
                    console.error(e);
                    alert("เกิดข้อผิดพลาดในการประมวลผล");
                    document.getElementById('loading').style.display = 'none';
                }
            }, 100);
        }

        async function saveAndReset() {
            document.getElementById('loading').style.display = 'flex';
            
            // Prepare Data
            const payload = {
                ...analysisMeta,
                type: 'feedback',
                selectedTraits: Array.from(selectedTraits).join(", "),
                selectedHealth: Array.from(selectedHealth).join(", "),
                timestamp: new Date().toISOString()
            };

            // Send to Google Sheet (Fire & Forget for speed, or await if you must confirm)
            // Using Fire & Forget strategy to make it fast for user
            logToGoogleSheet(payload);

            // Fake delay for UX (0.8s) then reset
            setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('cardObject').classList.remove('is-flipped');
                currentSessionId = 'u' + Date.now() + 'r' + Math.floor(Math.random()*1000);
                alert("บันทึกข้อมูลเรียบร้อย ขอบคุณครับ");
            }, 800);
        }

        function resetCard() { document.getElementById('cardObject').classList.remove('is-flipped'); }
    </script>
</body>
</html>
